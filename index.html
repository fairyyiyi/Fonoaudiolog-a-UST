<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Interactiva Fonoaudiología UST</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 2rem;
      background-color: #ffe6f0; /* rosa pastel claro */
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #b347a3;
      margin-bottom: 1.5rem;
      text-shadow: 1px 1px 3px #f0c0e9;
    }

    .malla {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding-bottom: 1rem;
      scrollbar-width: thin;
      scrollbar-color: #b347a3 #fce9f8;
    }
    .malla::-webkit-scrollbar {
      height: 8px;
    }
    .malla::-webkit-scrollbar-thumb {
      background: #b347a3;
      border-radius: 4px;
    }
    .malla::-webkit-scrollbar-track {
      background: #fce9f8;
      border-radius: 4px;
    }

    .semestre {
      background: #f9d4e7; /* rosa pastel */
      border-radius: 15px;
      min-width: 230px;
      max-width: 230px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      box-shadow:
        0 0 8px 1px #f7a6d9,
        inset 0 0 10px 1px #f7a6d9;
    }

    .semestre h2 {
      text-align: center;
      margin-bottom: 1rem;
      color: #8a2b8a;
      text-shadow: 0 0 5px #d88acc;
      user-select: none;
    }

    .ramo {
      background: #f7b7d9; /* rosa medio pastel */
      border-radius: 10px;
      padding: 0.6rem 0.8rem;
      margin-bottom: 0.8rem;
      cursor: pointer;
      text-align: center;
      user-select: none;
      box-shadow:
        0 0 5px 1px #eea7cf,
        inset 0 0 8px 1px #eea7cf;
      transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
      position: relative;
    }

    .ramo.aprobado {
      background: #b19cd9; /* morado pastel */
      color: white;
      box-shadow:
        0 0 10px 2px #8a6ed8,
        inset 0 0 10px 3px #b19cd9;
      text-decoration: none;
    }

    .ramo.aprobado .nombre {
      text-decoration: line-through;
    }

    .nombre {
      flex: 1;
    }

    .ramo.inactivo {
      opacity: 0.45;
      cursor: not-allowed;
      pointer-events: none;
      box-shadow: none;
      color: #7a5a7a;
    }

    /* Tooltip para la info opcional (puedes activar si quieres) */
    /*
    .ramo:hover::after {
      content: attr(data-info);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: #b19cd9;
      color: white;
      padding: 5px 8px;
      border-radius: 5px;
      white-space: pre-wrap;
      font-size: 11px;
      box-shadow: 0 0 5px #8a6ed8;
      z-index: 10;
      width: 200px;
    }
    */
  </style>
</head>
<body>

  <h1>Malla Interactiva Fonoaudiología UST</h1>

  <div class="malla" id="malla">

    <!-- Los semestres se crean dinámicamente con JS -->

  </div>

  <script>
    // Datos de la malla con prerrequisitos
    const mallaData = [
      {
        semestre: "I Semestre",
        ramos: [
          { nombre: "Razonamiento Lógico Matemático", abre: ["Acústica y Biomecánica", "Estadística y Epidemiología en Fonoaudiología"] },
          { nombre: "Introducción a la Fonoaudiología", abre: ["Comunicación y Lingüística"] },
          { nombre: "Atención Básica de Urgencias", abre: [] },
          { nombre: "Taller de Competencias para el Aprendizaje", abre: [] },
          { nombre: "Principios de la Biología", abre: [] },
          { nombre: "Taller de Competencias Comunicativas", abre: [] }
        ]
      },
      {
        semestre: "II Semestre",
        ramos: [
          { nombre: "Acústica y Biomecánica", abre: ["Valoración Auditiva en el Curso de Vida I"] },
          { nombre: "Comunicación y Lingüística", abre: ["Significado y Estructuras del Lenguaje"] },
          { nombre: "Procesos Cognitivos y Desarrollo en el Curso de Vida", abre: ["Neuropsiquiatría"] },
          { nombre: "Anatomía y Fisiología General", abre: ["Bases Morfofuncionales de la Fonoaudiología"] },
          { nombre: "Salud y Sociedad", abre: ["Evaluación Participativa con la Comunidad"] },
          { nombre: "Cultura y Valores", abre: [] }
        ]
      },
      {
        semestre: "III Semestre",
        ramos: [
          { nombre: "Estadística y Epidemiología en Fonoaudiología", abre: ["Valoración Auditiva en el Curso de Vida I"] },
          { nombre: "Significado y Estructuras del Lenguaje", abre: ["Lenguaje y Sociedad"] },
          { nombre: "Neuropsiquiatría", abre: ["Desarrollo en el Adulto y Personas Mayores"] },
          { nombre: "Bases Morfofuncionales de la Fonoaudiología", abre: ["Fonoestomatología", "Fisiopatología de la Comunicación"] },
          { nombre: "Personas y Sentido", abre: [] },
          { nombre: "Taller de Desarrollo Personal I", abre: [] },
          { nombre: "Inglés Básico I", abre: [] }
        ]
      },
      {
        semestre: "IV Semestre",
        ramos: [
          { nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 1", abre: [] },
          { nombre: "Lenguaje y Sociedad", abre: ["Desarrollo en Niños, Niñas y Adolescentes", "Abordaje Fonoaudiológico en la Comunidad Educativa"] },
          { nombre: "Fonoestamología", abre: ["Desarrollo de la Voz y Técnica Vocal"] },
          { nombre: "Fisiopatología de la Comunicación", abre: [] },
          { nombre: "Evaluación Participativa con la Comunidad", abre: ["Intervención Comunicativa"] },
          { nombre: "Taller de Desarrollo Personal II", abre: [] },
          { nombre: "Inglés Básico II", abre: [] }
        ]
      },
      {
        semestre: "V Semestre",
        ramos: [
          { nombre: "Valoración Auditiva en el Curso de Vida I", abre: ["Valoración Auditiva en el Curso de Vida II"] },
          { nombre: "Desarrollo en Niños, Niñas y Adolescentes I", abre: ["Abordaje en Niños, Niñas y Adolescentes I"] },
          { nombre: "Desarrollo en el Adulto y Personas Mayores", abre: ["Abordaje en Adultos y Personas Mayores I"] },
          { nombre: "Abordaje Fonoaudiológico en la Comunicación Educativa", abre: [] },
          { nombre: "Intervención Comunitaria", abre: [] },
          { nombre: "Ética y Salud", abre: [] }
        ]
      },
      {
        semestre: "VI Semestre",
        ramos: [
          { nombre: "Gestión e Innovación en Fonoaudiología", abre: ["Metodología de la Investigación"] },
          { nombre: "Abordaje en Niños, Niñas y Adolescentes I", abre: ["Abordaje en Niños, Niñas y Adolescentes II"] },
          { nombre: "Abordaje en Adultos y Personas Mayores I", abre: ["Abordaje en Adultos y Personas Mayores II"] },
          { nombre: "Bases de la Rehabilitación y Redes Integradas de Servicio de Salud", abre: [] },
          { nombre: "Valoración Auditiva en el Curso de Vida II", abre: ["Abordaje de la Voz Hablada y Cantada I"] },
          { nombre: "Desarrollo de la Voz y Técnica Vocal", abre: ["Abordaje de la Voz Hablada y Cantada I"] },
          { nombre: "Electivo I", abre: [] }
        ]
      },
      {
        semestre: "VII Semestre",
        ramos: [
          { nombre: "Abordaje en Niños, Niñas y Adolescentes II", abre: ["Abordaje de la Deglución y Alimentación Oral"] },
          { nombre: "Abordaje en Adultos y Personas Mayores II", abre: ["Abordaje de la Deglución y Alimentación Oral"] },
          { nombre: "Electivo II", abre: [] },
          { nombre: "Abordaje Auditivo en el Curso de Vida", abre: ["Abordaje Vesicular en el Curso de Vida"] },
          { nombre: "Abordaje de la Voz Hablada y Cantada I", abre: ["Abordaje de la Voz Hablada y Cantada II"] },
          { nombre: "Práctica Curricular I", abre: ["Práctica Curricular II"] }
        ]
      },
      {
        semestre: "VIII Semestre",
        ramos: [
          { nombre: "Metodología de la Investigación", abre: ["Seminario de Grado I"] },
          { nombre: "Abordaje de la Deglución y Alimentación Oral", abre: [] },
          { nombre: "Electivo III", abre: [] },
          { nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 2", abre: [] },
          { nombre: "Abordaje Vesicular en el Curso de Vida", abre: [] },
          { nombre: "Abordaje de la Voz Hablada y Cantada II", abre: [] },
          { nombre: "Práctica Curricular II", abre: [] }
        ]
      },
      {
        semestre: "IX Semestre",
        ramos: [
          { nombre: "Seminario de Grado I", abre: ["Seminario de Grado II"] },
          { nombre: "Internado Profesional I", abre: [] },
          { nombre: "Internado Profesional II", abre: [] }
        ]
      },
      {
        semestre: "X Semestre",
        ramos: [
          { nombre: "Seminario de Grado II", abre: [] },
          { nombre: "Internado III", abre: [] },
          { nombre: "Internado IV", abre: [] }
        ]
      }
    ];

    // Crear mapa de ramos para activar prerrequisitos más fácil
    const ramoMap = new Map();

    // Estado aprobado para cada ramo (nombre => boolean)
    const estadoAprobado = new Map();

    // Crear cada semestre y ramos en DOM
    const mallaDiv = document.getElementById("malla");

    function crearRamo(ramo, semestreIndex) {
      const div = document.createElement("div");
      div.classList.add("ramo");
      div.textContent = ramo.nombre;

      div.dataset.nombre = ramo.nombre;
      div.dataset.semestre = semestreIndex;
      div.dataset.abre = JSON.stringify(ramo.abre);

      // Contenedor nombre para tachar solo texto
      const spanNombre = document.createElement("span");
      spanNombre.classList.add("nombre");
      spanNombre.textContent = ramo.nombre;
      div.textContent = "";
      div.appendChild(spanNombre);

      return div;
    }

    function actualizarEstadoUI() {
      // Primero desactivar todos los ramos que no sean del primer semestre ni aprobados ni con prerrequisitos desbloqueados
      for (let [nombre, ramoObj] of ramoMap.entries()) {
        const div = ramoObj.element;
        const semestreIndex = ramoObj.semestre;

        if (semestreIndex === 0) {
          div.classList.remove("inactivo");
          div.style.pointerEvents = "auto";
        } else {
          // Se activa solo si algún ramo que abre este ramo está aprobado
          let activar = false;

          // Buscar ramos que abren este ramo
          for (let [otherNombre, otherRamoObj] of ramoMap.entries()) {
            if (otherRamoObj.ramo.abre.includes(nombre) && estadoAprobado.get(otherNombre)) {
              activar = true;
              break;
            }
          }

          if (activar) {
            div.classList.remove("inactivo");
            div.style.pointerEvents = "auto";
          } else {
            // Si no está aprobado y no tiene prerrequisito aprobado
            if (!estadoAprobado.get(nombre)) {
              div.classList.add("inactivo");
              div.style.pointerEvents = "none";
            } else {
              div.classList.remove("inactivo");
              div.style.pointerEvents = "auto";
            }
          }
        }
      }

      // Actualizar colores y tachado según estado aprobado
      for (let [nombre, ramoObj] of ramoMap.entries()) {
        const div = ramoObj.element;
        if (estadoAprobado.get(nombre)) {
          div.classList.add("aprobado");
        } else {
          div.classList.remove("aprobado");
        }
      }
    }

    function guardarEstado() {
      // Guardar estado aprobado en localStorage
      const estadoObj = {};
      for (let [nombre, aprobado] of estadoAprobado.entries()) {
        estadoObj[nombre] = aprobado;
      }
      localStorage.setItem("estadoMallaFono", JSON.stringify(estadoObj));
    }

    function cargarEstado() {
      const estadoGuardado = localStorage.getItem("estadoMallaFono");
      if (estadoGuardado) {
        const estadoObj = JSON.parse(estadoGuardado);
        for (let nombre in estadoObj) {
          estadoAprobado.set(nombre, estadoObj[nombre]);
        }
      }
    }

    // Inicializar UI y eventos
    function inicializar() {
      cargarEstado();

      mallaData.forEach((semestreObj, i) => {
        const semDiv = document.createElement("div");
        semDiv.classList.add("semestre");
        const titulo = document.createElement("h2");
        titulo.textContent = semestreObj.semestre;
        semDiv.appendChild(titulo);

        semestreObj.ramos.forEach((ramo) => {
          const ramoDiv = crearRamo(ramo, i);
          semDiv.appendChild(ramoDiv);
          ramoMap.set(ramo.nombre, {
            elemento: ramoDiv,
            element: ramoDiv,
            ramo: ramo,
            semestre: i
          });
        });

        mallaDiv.appendChild(semDiv);
      });

      // Añadir listeners después de crear todo
      for (let [nombre, ramoObj] of ramoMap.entries()) {
        const div = ramoObj.element;
        div.addEventListener("click", () => {
          if (div.classList.contains("inactivo")) return; // no hacer nada si está inactivo

          const aprobado = estadoAprobado.get(nombre) || false;
          estadoAprobado.set(nombre, !aprobado);

          actualizarEstadoUI();
          guardarEstado();
        });
      }

      actualizarEstadoUI();
    }

    inicializar();

  </script>
</body>
</html>
