<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Interactiva Fonoaudiología UST</title>
<style>
  body {
    margin: 0; padding: 20px;
    background: #f9f5f8; /* pastel rosa muy suave */
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
    color: #6a3d6e; /* morado */
  }
  .malla {
    display: flex;
    justify-content: center;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 10px;
  }
  .semestre {
    background: #f2d9e6; /* rosa pastel */
    border-radius: 12px;
    min-width: 150px;
    max-width: 150px;
    padding: 10px 8px;
    box-shadow: 0 0 10px rgba(180,130,180,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  .semestre h3 {
    margin: 0 0 10px 0;
    font-weight: 700;
    color: #853d7a;
  }
  .ramo {
    background: #e8cce7; /* rosa pastel más fuerte */
    width: 100%;
    min-height: 55px;
    margin-bottom: 8px;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(180,130,180,0.4);
    padding: 6px 5px;
    text-align: center;
    line-height: 1.1;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .ramo.inactivo {
    opacity: 0.4;
    cursor: default;
  }
  .ramo.aprobado {
    background: #a388b9; /* morado pastel */
    box-shadow: 0 0 12px #aa95c6;
    color: white;
  }
  .ramo.aprobado .nombre {
    text-decoration: line-through;
  }
  .nombre {
    font-weight: 600;
    font-size: 11px;
  }
</style>
</head>
<body>
<h1>Malla Interactiva Fonoaudiología UST</h1>
<div class="malla" id="malla">

  <!-- Semestres y ramos generados por JS -->

</div>

<script>
  // Datos con prerrequisitos (lo que abre)  
  const semestres = [
    { nombre: "I Semestre", ramos: [
      { id: "ramo1", nombre: "Razonamiento Lógico Matemático", abre: ["ramo7", "ramo8"] },
      { id: "ramo2", nombre: "Introducción a la Fonoaudiología", abre: ["ramo9"] },
      { id: "ramo3", nombre: "Atención Básica de Urgencias", abre: [] },
      { id: "ramo4", nombre: "Taller de Competencias para el Aprendizaje", abre: [] },
      { id: "ramo5", nombre: "Principios de la Biología", abre: [] },
      { id: "ramo6", nombre: "Taller de Competencias Comunicativas", abre: [] }
    ]},
    { nombre: "II Semestre", ramos: [
      { id: "ramo7", nombre: "Acústica y Biomecánica", abre: ["ramo13"] },
      { id: "ramo8", nombre: "Comunicación y Lingüística", abre: ["ramo14"] },
      { id: "ramo9", nombre: "Procesos Cognitivos y Desarrollo en el Curso de Vida", abre: ["ramo15"] },
      { id: "ramo10", nombre: "Anatomía y Fisiología General", abre: ["ramo16"] },
      { id: "ramo11", nombre: "Salud y Sociedad", abre: ["ramo17"] },
      { id: "ramo12", nombre: "Cultura y Valores", abre: [] }
    ]},
    { nombre: "III Semestre", ramos: [
      { id: "ramo13", nombre: "Estadística y Epidemiología en Fonoaudiología", abre: ["ramo18"] },
      { id: "ramo14", nombre: "Significado y Estructuras del Lenguaje", abre: ["ramo19"] },
      { id: "ramo15", nombre: "Neuropsiquiatría", abre: ["ramo20"] },
      { id: "ramo16", nombre: "Bases Morfofuncionales de la Fonoaudiología", abre: ["ramo21", "ramo22"] },
      { id: "ramo17", nombre: "Personas y Sentido", abre: [] },
      { id: "ramo18", nombre: "Taller de Desarrollo Personal I", abre: [] },
      { id: "ramo19", nombre: "Inglés Básico I", abre: [] }
    ]},
    { nombre: "IV Semestre", ramos: [
      { id: "ramo20", nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 1", abre: [] },
      { id: "ramo21", nombre: "Lenguaje y Sociedad", abre: ["ramo23", "ramo24"] },
      { id: "ramo22", nombre: "Fonoestamología", abre: ["ramo25"] },
      { id: "ramo23", nombre: "Fisiopatología de la Comunicación", abre: [] },
      { id: "ramo24", nombre: "Evaluación Participativa con la Comunidad", abre: ["ramo26"] },
      { id: "ramo25", nombre: "Taller de Desarrollo Personal II", abre: [] },
      { id: "ramo26", nombre: "Inglés Básico II", abre: [] }
    ]},
    { nombre: "V Semestre", ramos: [
      { id: "ramo27", nombre: "Valoración Auditiva en el Curso de Vida I", abre: ["ramo28"] },
      { id: "ramo28", nombre: "Desarrollo en Niños, Niñas y Adolescentes I", abre: ["ramo29"] },
      { id: "ramo29", nombre: "Desarrollo en el Adulto y Personas Mayores", abre: ["ramo30"] },
      { id: "ramo30", nombre: "Abordaje Fonoaudiológico en la Comunicación Educativa", abre: [] },
      { id: "ramo31", nombre: "Intervención Comunitaria", abre: [] },
      { id: "ramo32", nombre: "Ética y Salud", abre: [] }
    ]},
    { nombre: "VI Semestre", ramos: [
      { id: "ramo33", nombre: "Gestión e Innovación en Fonoaudiología", abre: ["ramo34"] },
      { id: "ramo34", nombre: "Abordaje en Niños, Niñas y Adolescentes I", abre: ["ramo35"] },
      { id: "ramo35", nombre: "Abordaje en Adultos y Personas Mayores I", abre: ["ramo36"] },
      { id: "ramo36", nombre: "Bases de la Rehabilitación y Redes Integradas de Servicio de Salud", abre: [] },
      { id: "ramo37", nombre: "Valoración Auditiva en el Curso de Vida II", abre: ["ramo38"] },
      { id: "ramo38", nombre: "Desarrollo de la Voz y Técnica Vocal", abre: ["ramo38"] },
      { id: "ramo39", nombre: "Electivo I", abre: [] }
    ]},
    { nombre: "VII Semestre", ramos: [
      { id: "ramo40", nombre: "Abordaje en Niños, Niñas y Adolescentes II", abre: ["ramo41"] },
      { id: "ramo41", nombre: "Abordaje en Adultos y Personas Mayores II", abre: ["ramo42"] },
      { id: "ramo42", nombre: "Electivo II", abre: [] },
      { id: "ramo43", nombre: "Abordaje Auditivo en el Curso de Vida", abre: ["ramo44"] },
      { id: "ramo44", nombre: "Abordaje de la Voz Hablada y Cantada I", abre: ["ramo45"] },
      { id: "ramo45", nombre: "Práctica Curricular I", abre: ["ramo46"] }
    ]},
    { nombre: "VIII Semestre", ramos: [
      { id: "ramo46", nombre: "Metodología de la Investigación", abre: ["ramo47"] },
      { id: "ramo47", nombre: "Abordaje de la Deglución y Alimentación Oral", abre: [] },
      { id: "ramo48", nombre: "Electivo III", abre: [] },
      { id: "ramo49", nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 2", abre: [] },
      { id: "ramo50", nombre: "Abordaje Vesicular en el Curso de Vida", abre: [] },
      { id: "ramo51", nombre: "Abordaje de la Voz Hablada y Cantada II", abre: [] },
      { id: "ramo52", nombre: "Práctica Curricular II", abre: [] }
    ]},
    { nombre: "IX Semestre", ramos: [
      { id: "ramo53", nombre: "Seminario de Grado I", abre: ["ramo54"] },
      { id: "ramo54", nombre: "Internado Profesional I", abre: [] },
      { id: "ramo55", nombre: "Internado Profesional II", abre: [] }
    ]},
    { nombre: "X Semestre", ramos: [
      { id: "ramo56", nombre: "Seminario de Grado II", abre: [] },
      { id: "ramo57", nombre: "Internado III", abre: [] },
      { id: "ramo58", nombre: "Internado IV", abre: [] }
    ]}
  ];

  // Contenedor
  const malla = document.getElementById('malla');

  // Guardar estado en localStorage
  const storageKey = 'mallaAprobados';

  // Carga estados guardados
  let aprobados = JSON.parse(localStorage.getItem(storageKey)) || {};

  // Función para renderizar semestres y ramos
  function renderizarMalla() {
    malla.innerHTML = '';
    semestres.forEach((semestre, i) => {
      const divSemestre = document.createElement('div');
      divSemestre.classList.add('semestre');
      const titulo = document.createElement('h3');
      titulo.textContent = semestre.nombre;
      divSemestre.appendChild(titulo);

      semestre.ramos.forEach(ramo => {
        const divRamo = document.createElement('div');
        divRamo.classList.add('ramo');
        divRamo.id = ramo.id;
        const spanNombre = document.createElement('span');
        spanNombre.classList.add('nombre');
        spanNombre.textContent = ramo.nombre;
        divRamo.appendChild(spanNombre);

        // Aplicar estilos si está aprobado
        if (aprobados[ramo.id]) {
          divRamo.classList.add('aprobado');
        }

        divSemestre.appendChild(divRamo);
      });

      malla.appendChild(divSemestre);
    });
  }

  // Función para chequear y actualizar activación de ramos
  function actualizarActivacion() {
    // Primero desactivar todos excepto primer semestre
    semestres.forEach((semestre, i) => {
      semestre.ramos.forEach(ramo => {
        const el = document.getElementById(ramo.id);
        // Semestre 0 (primer semestre) siempre activo
        if(i === 0) {
          el.classList.remove('inactivo');
        } else {
          el.classList.add('inactivo');
          // salvo si es prerrequisito de algún ramo aprobado en ese semestre (ver abajo)
        }
      });
    });

    // Activar ramos que abren los aprobados
    Object.keys(aprobados).forEach(aprId => {
      if(!aprobados[aprId]) return; // sólo aprobados
      // Buscar ramo que abre
      let found = null;
      semestres.forEach(semestre => {
        semestre.ramos.forEach(ramo => {
          if(ramo.id === aprId) found = ramo;
        });
      });
      if(found && found.abre.length) {
        found.abre.forEach(abreId => {
          const abreEl = document.getElementById(abreId);
          if (abreEl) {
            abreEl.classList.remove('inactivo');
          }
        });
      }
    });

    // Además activar ramos sin prerrequisito si algún ramo del semestre está activo
    semestres.forEach((semestre, i) => {
      if(i === 0) return; // primer semestre ya activo todo
      // Revisar si hay algún ramo activo
      let hayActivo = semestre.ramos.some(ramo => {
        const el = document.getElementById(ramo.id);
        return !el.classList.contains('inactivo');
      });
      if(hayActivo) {
        // Activar los sin prerrequisito
        semestre.ramos.forEach(ramo => {
          const el = document.getElementById(ramo.id);
          if(ramo.abre.length === 0) {
            el.classList.remove('inactivo');
          }
        });
      }
    });
  }

  // Al hacer click en un ramo
  function onClickRamo(event) {
    const el = event.currentTarget;
    if(el.classList.contains('inactivo')) return; // no hacer nada si inactivo
    const id = el.id;
    const aprobadoAntes = aprobados[id];
    if(aprobadoAntes) {
      // Desaprobado
      aprobados[id] = false;
      el.classList.remove('aprobado');
    } else {
      // Aprobado
      aprobados[id] = true;
      el.classList.add('aprobado');
    }
    // Actualizar activaciones
    actualizarActivacion();
    // Guardar en localStorage
    localStorage.setItem(storageKey, JSON.stringify(aprobados));
  }

  // Inicializar
  function init() {
    renderizarMalla();
    actualizarActivacion();

    // Añadir eventos
    semestres.forEach(semestre => {
      semestre.ramos.forEach(ramo => {
        const el = document.getElementById(ramo.id);
        el.addEventListener('click', onClickRamo);
      });
    });
  }

  window.onload = init;

</script>
</body>
</html>
