<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Interactiva Fonoaudiología UST</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0.8rem;
      background-color: #ffe6f0;
      font-family: 'Inter', sans-serif;
      font-size: 10px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #b347a3;
      margin-bottom: 0.7rem;
      text-shadow: 1px 1px 3px #f0c0e9;
      font-size: 1.4rem;
    }

    .malla {
      display: flex;
      gap: 0.4rem;
      overflow-x: auto;
      padding-bottom: 0.4rem;
      scrollbar-width: thin;
      scrollbar-color: #b347a3 #fce9f8;
    }
    .malla::-webkit-scrollbar {
      height: 6px;
    }
    .malla::-webkit-scrollbar-thumb {
      background: #b347a3;
      border-radius: 3px;
    }
    .malla::-webkit-scrollbar-track {
      background: #fce9f8;
      border-radius: 3px;
    }

    .semestre {
      background: #f9d4e7;
      border-radius: 12px;
      min-width: 170px;
      max-width: 170px;
      padding: 0.4rem 0.5rem;
      display: flex;
      flex-direction: column;
      box-shadow:
        0 0 6px 1px #f7a6d9,
        inset 0 0 7px 1px #f7a6d9;
    }

    .semestre h2 {
      text-align: center;
      margin-bottom: 0.5rem;
      color: #8a2b8a;
      text-shadow: 0 0 4px #d88acc;
      user-select: none;
      font-size: 1rem;
    }

    .ramo {
      background: #f7b7d9;
      border-radius: 8px;
      padding: 0.25rem 0.35rem;
      margin-bottom: 0.3rem;
      cursor: pointer;
      text-align: center;
      user-select: none;
      box-shadow:
        0 0 4px 1px #eea7cf,
        inset 0 0 5px 1px #eea7cf;
      transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
      min-height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 9px;
      position: relative;
      line-height: 1.1em;
    }

    .ramo.aprobado {
      background: #b19cd9;
      color: white;
      box-shadow:
        0 0 9px 2px #8a6ed8,
        inset 0 0 9px 2px #b19cd9;
    }

    .ramo.aprobado .nombre {
      text-decoration: line-through;
    }

    .nombre {
      flex: 1;
      white-space: normal;
    }

    .ramo.inactivo {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
      box-shadow: none;
      color: #7a5a7a;
    }
  </style>
</head>
<body>

  <h1>Malla Interactiva Fonoaudiología UST</h1>

  <div class="malla" id="malla"></div>

  <script>
    const mallaData = [
      {
        semestre: "I Semestre",
        ramos: [
          { nombre: "Razonamiento Lógico Matemático", abre: ["Acústica y Biomecánica", "Estadística y Epidemiología en Fonoaudiología"] },
          { nombre: "Introducción a la Fonoaudiología", abre: ["Comunicación y Lingüística"] },
          { nombre: "Atención Básica de Urgencias", abre: [] },
          { nombre: "Taller de Competencias para el Aprendizaje", abre: [] },
          { nombre: "Principios de la Biología", abre: [] },
          { nombre: "Taller de Competencias Comunicativas", abre: [] }
        ]
      },
      {
        semestre: "II Semestre",
        ramos: [
          { nombre: "Acústica y Biomecánica", abre: ["Valoración Auditiva en el Curso de Vida I"] },
          { nombre: "Comunicación y Lingüística", abre: ["Significado y Estructuras del Lenguaje"] },
          { nombre: "Procesos Cognitivos y Desarrollo en el Curso de Vida", abre: ["Neuropsiquiatría"] },
          { nombre: "Anatomía y Fisiología General", abre: ["Bases Morfofuncionales de la Fonoaudiología"] },
          { nombre: "Salud y Sociedad", abre: ["Evaluación Participativa con la Comunidad"] },
          { nombre: "Cultura y Valores", abre: [] }
        ]
      },
      {
        semestre: "III Semestre",
        ramos: [
          { nombre: "Estadística y Epidemiología en Fonoaudiología", abre: ["Valoración Auditiva en el Curso de Vida I"] },
          { nombre: "Significado y Estructuras del Lenguaje", abre: ["Lenguaje y Sociedad"] },
          { nombre: "Neuropsiquiatría", abre: ["Desarrollo en el Adulto y Personas Mayores"] },
          { nombre: "Bases Morfofuncionales de la Fonoaudiología", abre: ["Fonoestomatología", "Fisiopatología de la Comunicación"] },
          { nombre: "Personas y Sentido", abre: [] },
          { nombre: "Taller de Desarrollo Personal I", abre: [] },
          { nombre: "Inglés Básico I", abre: [] }
        ]
      },
      {
        semestre: "IV Semestre",
        ramos: [
          { nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 1", abre: [] },
          { nombre: "Lenguaje y Sociedad", abre: ["Desarrollo en Niños, Niñas y Adolescentes", "Abordaje Fonoaudiológico en la Comunidad Educativa"] },
          { nombre: "Fonoestamología", abre: ["Desarrollo de la Voz y Técnica Vocal"] },
          { nombre: "Fisiopatología de la Comunicación", abre: [] },
          { nombre: "Evaluación Participativa con la Comunidad", abre: ["Intervención Comunicativa"] },
          { nombre: "Taller de Desarrollo Personal II", abre: [] },
          { nombre: "Inglés Básico II", abre: [] }
        ]
      },
      {
        semestre: "V Semestre",
        ramos: [
          { nombre: "Valoración Auditiva en el Curso de Vida I", abre: ["Valoración Auditiva en el Curso de Vida II"] },
          { nombre: "Desarrollo en Niños, Niñas y Adolescentes I", abre: ["Abordaje en Niños, Niñas y Adolescentes I"] },
          { nombre: "Desarrollo en el Adulto y Personas Mayores", abre: ["Abordaje en Adultos y Personas Mayores I"] },
          { nombre: "Abordaje Fonoaudiológico en la Comunicación Educativa", abre: [] },
          { nombre: "Intervención Comunitaria", abre: [] },
          { nombre: "Ética y Salud", abre: [] }
        ]
      },
      {
        semestre: "VI Semestre",
        ramos: [
          { nombre: "Gestión e Innovación en Fonoaudiología", abre: ["Metodología de la Investigación"] },
          { nombre: "Abordaje en Niños, Niñas y Adolescentes I", abre: ["Abordaje en Niños, Niñas y Adolescentes II"] },
          { nombre: "Abordaje en Adultos y Personas Mayores I", abre: ["Abordaje en Adultos y Personas Mayores II"] },
          { nombre: "Bases de la Rehabilitación y Redes Integradas de Servicio de Salud", abre: [] },
          { nombre: "Valoración Auditiva en el Curso de Vida II", abre: ["Abordaje de la Voz Hablada y Cantada I"] },
          { nombre: "Desarrollo de la Voz y Técnica Vocal", abre: ["Abordaje de la Voz Hablada y Cantada I"] },
          { nombre: "Electivo I", abre: [] }
        ]
      },
      {
        semestre: "VII Semestre",
        ramos: [
          { nombre: "Abordaje en Niños, Niñas y Adolescentes II", abre: ["Abordaje de la Deglución y Alimentación Oral"] },
          { nombre: "Abordaje en Adultos y Personas Mayores II", abre: ["Abordaje de la Deglución y Alimentación Oral"] },
          { nombre: "Electivo II", abre: [] },
          { nombre: "Abordaje Auditivo en el Curso de Vida", abre: ["Abordaje Vesicular en el Curso de Vida"] },
          { nombre: "Abordaje de la Voz Hablada y Cantada I", abre: ["Abordaje de la Voz Hablada y Cantada II"] },
          { nombre: "Práctica Curricular I", abre: ["Práctica Curricular II"] }
        ]
      },
      {
        semestre: "VIII Semestre",
        ramos: [
          { nombre: "Metodología de la Investigación", abre: ["Seminario de Grado I"] },
          { nombre: "Abordaje de la Deglución y Alimentación Oral", abre: [] },
          { nombre: "Electivo III", abre: [] },
          { nombre: "Evaluación del Desarrollo de Competencias MEC FON HITO 2", abre: [] },
          { nombre: "Abordaje Vesicular en el Curso de Vida", abre: [] },
          { nombre: "Abordaje de la Voz Hablada y Cantada II", abre: [] },
          { nombre: "Práctica Curricular II", abre: [] }
        ]
      },
      {
        semestre: "IX Semestre",
        ramos: [
          { nombre: "Seminario de Grado I", abre: ["Seminario de Grado II"] },
          { nombre: "Internado Profesional I", abre: [] },
          { nombre: "Internado Profesional II", abre: [] }
        ]
      },
      {
        semestre: "X Semestre",
        ramos: [
          { nombre: "Seminario de Grado II", abre: [] },
          { nombre: "Internado III", abre: [] },
          { nombre: "Internado IV", abre: [] }
        ]
      }
    ];

    const ramoMap = new Map();
    const estadoAprobado = new Map();

    const mallaDiv = document.getElementById("malla");

    function crearRamo(ramo, semestreIndex) {
      const div = document.createElement("div");
      div.classList.add("ramo");

      const spanNombre = document.createElement("span");
      spanNombre.classList.add("nombre");
      spanNombre.textContent = ramo.nombre;
      div.appendChild(spanNombre);

      div.dataset.nombre = ramo.nombre;
      div.dataset.semestre = semestreIndex;
      div.dataset.abre = JSON.stringify(ramo.abre);

      return div;
    }

    // Verifica si un ramo está activado para hacer clic
    function estaActivado(nombre) {
      // Si está aprobado, siempre activo
      if (estadoAprobado.get(nombre)) return true;

      // Verificar si algún ramo que abre este está aprobado
      for (let [otroNombre, ramoObj] of ramoMap.entries()) {
        if (ramoObj.ramo.abre.includes(nombre) && estadoAprobado.get(otroNombre)) {
          return true;
        }
      }

      // Si no tiene prerrequisito, verificar si algún ramo del mismo semestre está aprobado
      const ramoActual = ramoMap.get(nombre);
      if (ramoActual) {
        const prerrequisitos = ramoActual.ramo.abre;
        if (prerrequisitos.length === 0) {
          // Buscar si algún ramo del mismo semestre está aprobado
          const semestreIndex = ramoActual.semestre;
          for (let [nombre2, obj2] of ramoMap.entries()) {
            if (obj2.semestre === semestreIndex && estadoAprobado.get(nombre2)) {
              return true;
            }
          }
          // Si no hay aprobado en semestre, no activado
          return semestreIndex === 0; // primer semestre siempre activo
        }
      }

      return false;
    }

    function actualizarEstadoUI() {
      for (let [nombre, ramoObj] of ramoMap.entries()) {
        const div = ramoObj.element;
        const semestreIndex = ramoObj.semestre;

        if (semestreIndex === 0) {
          div.classList.remove("inactivo");
          div.style.pointerEvents = "auto";
        } else {
          if (estaActivado(nombre)) {
            div.classList.remove("inactivo");
            div.style.pointerEvents = "auto";
          } else {
            div.classList.add("inactivo");
            div.style.pointerEvents = "none";
          }
        }

        if (estadoAprobado.get(nombre)) {
          div.classList.add("aprobado");
        } else {
          div.classList.remove("aprobado");
        }
      }
    }

    function guardarEstado() {
      const estadoObj = {};
      for (let [nombre, aprobado] of estadoAprobado.entries()) {
        estadoObj[nombre] = aprobado;
      }
      localStorage.setItem("estadoMallaFono", JSON.stringify(estadoObj));
    }

    function cargarEstado() {
      const estadoGuardado = localStorage.getItem("estadoMallaFono");
      if (estadoGuardado) {
        const estadoObj = JSON.parse(estadoGuardado);
        for (let nombre in estadoObj) {
          estadoAprobado.set(nombre, estadoObj[nombre]);
        }
      }
    }

    function inicializar() {
      cargarEstado();

      mallaData.forEach((semestreObj, i) => {
        const semDiv = document.createElement("div");
        semDiv.classList.add("semestre");

        const titulo = document.createElement("h2");
        titulo.textContent = semestreObj.semestre;
        semDiv.appendChild(titulo);

        semestreObj.ramos.forEach((ramo) => {
          const ramoDiv = crearRamo(ramo, i);
          semDiv.appendChild(ramoDiv);
          ramoMap.set(ramo.nombre, {
            element: ramoDiv,
            ramo: ramo,
            semestre: i
          });
        });

        mallaDiv.appendChild(semDiv);
      });

      for (let [nombre, ramoObj] of ramoMap.entries()) {
        const div = ramoObj.element;
        div.addEventListener("click", () => {
          if (div.classList.contains("inactivo")) return;

          const actual = estadoAprobado.get(nombre) || false;
          estadoAprobado.set(nombre, !actual);

          actualizarEstadoUI();
          guardarEstado();
        });
      }

      actualizarEstadoUI();
    }

    inicializar();
  </script>
</body>
</html>
